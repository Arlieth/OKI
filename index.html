<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>SFV OKI LOL</title>
<style>

  body {
    background-color: #000;
    color: #fff;
    font-family: sans-serif;
    margin-bottom: 500px;
  }

  path {
    stroke-width: 1px;
    stroke: #333;
    fill: #ddd;
    vector-effect: non-scaling-stroke;
  }

  .GRID line {
    vector-effect: non-scaling-stroke;
  }

  .REPLAY line {
    vector-effect: non-scaling-stroke;
  }

  .UNOC { display: none; }

  .fred { fill: #c00 !important; }

  .gray { stroke: #333; }
  .red { stroke: #f00; }
  .green { stroke: #0f0; }
  .blue { stroke: #00f; }
  .cyan { stroke: #0ff; }
  .yellow { stroke: #ff0; }

  .p1gray { stroke: #333; }
  .p1red { stroke: #f00; }
  .p1green { stroke: #0f0; }
  .p1blue { stroke: #00f; }
  .p1hit { stroke: #c6f; }
  .p1cyan { stroke: #0ff; }
  .p1yellow { stroke: #ff0; }

  .p2gray { stroke: #333; }
  .p2red { stroke: #f66; }
  .p2green { stroke: #6f6; }
  .p2blue { stroke: #66f; }
  .p2hit { stroke: #c6f; }
  .p2cyan { stroke: #6ff; }

  .hitbox { color: #f99; }
  .hit { color: #969; }
  .first { color: #cfc; background-color: #363;}
  .iasa1 { color: #999;}

  #REPLAYS {
    text-align: center;
    /*display: inline-block;*/
  }

  #REPLAYS  !svg + div {
    /*display: inline-block;*/
  }

  #REPLAYS div {
    height: 500px;
    overflow-x: hidden;
    overflow-y: auto;
    display: inline-block;
    padding-right: 2em;
  }

  #LINKS {
    /*height: 500px;*/
    white-space: nowrap;
    overflow: auto;
  }

  #FRAMES, #KD {
    white-space: nowrap;
    /*height: 500px;*/
    /*overflow-x: hidden;*/
    /*overflow-y: auto;*/
    /*display: inline-block;*/
    /*padding-right: 2em;*/
  }

  #FRAMES div {
    display: inline-block;
    vertical-align: top;
  }

  table.FRAMES {
    table-layout: fixed;
    font: 10px sans-serif;
    text-align: center;
    color: #ccc;
  }

  table.FRAMES tr:nth-child(even) {
    background-color: #333; 
  }

  table.FRAMES tr:nth-child(odd) {
    background-color: #111; 
  }
  table.FRAMES td {
    white-space: nowrap;
  }

  table.FRAMES tr:hover {
    background-color: #030;
  }

  table.FRAMES tr.UC {
    background-color: #060;
  }
  table.FRAMES td.UC {
    background-color: #060;
  }

  #LINKS div.COL {
    display: inline-block;
    vertical-align: top;
  }

  #LINKS div.COL div {
    text-align: left;
    padding: 10px;
  }

  #LINKS button {
    background-color: #ccc;
    padding: 10px 10px;
  }

  svg {
    border: 1px solid #333;
    margin-top: 10px;
  }

  .REPLAY rect {
    stroke-width: 1px;
    /*stroke: #333;*/
    fill: none;
    /*opacity: 0.8;*/
    mix-blend-mode: screen;
    vector-effect: non-scaling-stroke;
  }

  .REPLAY rect.clip {
    fill: #330;
  }

  .REPLAY text {
    text-anchor: middle;
    fill: #999;
    font: 8px sans-serif;
  }

  .rects text {
    text-anchor: middle;
    fill: #999;
    font: 10px sans-serif;
  }

  .axis {
    font: 10px sans-serif;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }

  .axis text {
    fill: #ddd;
  }

  .axis .domain {
    fill: none;
    stroke: #000;
    stroke-opacity: .3;
    stroke-width: 10px;
    stroke-linecap: round;
  }

  .axis .halo {
    fill: none;
    stroke: #ddd;
    stroke-width: 8px;
    stroke-linecap: round;
  }

  .slider .handle {
    fill: #fff;
    fill-opacity: .75;
    stroke: #000;
    stroke-opacity: .5;
    stroke-width: 1.25px;
    cursor: crosshair;
  }

  #OKI > span.GRID {
    color: #ccc;
  }

  .GRID > span:nth-child(10n) {
    color: #eee;
  }


  .GRID > span.ACTIVE {
    color: #fcc;
  }

  .GRID > span.STARTUP {
    color: #aaa;
  }

  .GRID > span.RECOVERY {
    color: #aaa;
  }

  .GRID > span.WAKEUP {
    color: #cfc;
  }

  .GRID > span.FK {
    color: #ccc;
  }


  .UCLICK:hover {
    color: #fff;
    background-color: #990;
    cursor: pointer;
  }

  button.CHAR {
    padding: 5px;
    margin: 3px;
    /*width: 8%;*/
    background-color: #999;
  }

  button.SEL {
    background-color: #ffc;
  }
</style>
</head>
<body>
<div id="CHARS"></div>
<div id="KD"></div>
<div>
<pre id="OKI">
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="TOP10"   class="GRID">0........1.........2.........3.........4.........5.........6.........7.........8.........9.........10........11........</span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="TOP1"    class="GRID">12345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789</span>
<span          >KD&nbsp;&nbsp;&nbsp;</span><span id="ADVKD"   class="GRID"></span>
<span                    >KDBR&nbsp;</span><span id="ADVKDBR" class="GRID"></span>
<span               >KDR&nbsp;&nbsp;</span><span id="ADVKDR"  class="GRID"></span>
<span               >OKI&nbsp;&nbsp;</span><span id="ADVOKI"  class="GRID"></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="FK"      class="GRID">12345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789</span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="FK10"    class="GRID">0........1.........2.........3.........4.........5.........6.........7.........8.........9.........10........11........</span>
</pre>
</div>
<div id="FRAMES"></div>
<script src="d3.min.js"></script>
<script>
var KDMOVE = null;
var OKIMOVE = null;
var FRAMEKILL = 19;
var HASHKD = 79+1;
var HASHKDBR = 25+1;
var HASHKDR = 20+1;
var HASHCHAR = "KRN";
var HASHSTARTUP = 5;
var HASHACTIVE = 4;
var HASHRECOVERY = 10;
function MECHASH() {
  var h = window.location.hash.substr(1).split("/");
  if (h.length >= 1 && CHARS[0].indexOf(h[0].toUpperCase()) != -1) HASHCHAR = h[0];
  if (h.length >= 2 && !isNaN(h[1]) && h[1] != "") HASHKD = +(h[1].trim())+1;
  if (h.length >= 3 && !isNaN(h[2]) && h[2] != "") HASHKDBR = +(h[2].trim())+1;
  if (h.length >= 4 && !isNaN(h[3]) && h[3] != "") HASHKDR = +(h[3].trim())+1;
  if (h.length >= 5 && !isNaN(h[4]) && h[4] != "") FRAMEKILL = +(h[4].trim())+1;
  if (h.length >= 6 && !isNaN(h[5]) && h[5] != "") HASHSTARTUP = +(h[5].trim());
  if (h.length >= 7 && !isNaN(h[6]) && h[6] != "") HASHACTIVE = +(h[6].trim());
  if (h.length >= 8 && !isNaN(h[7]) && h[7] != "") HASHRECOVERY = +(h[7].trim());
}

function UCHASH() {
  var h = "#" + (HASHCHAR) + "/" + (+HASHKD-1) + "/" + (+HASHKDBR-1) + "/" + (+HASHKDR-1) + "/" + (FRAMEKILL-1) + "/" + HASHSTARTUP + "/" + HASHACTIVE + "/" + HASHRECOVERY;
  if (h != window.location.hash) window.location.hash = h;
}

var CHARS = [
["ALX", "BLR", //"BLR2", "BRD", "BRD2", "CMY", "CNL", "CNL2", "DSM", "FAN", 
"GUL", "KEN", "KRN", //"LAR", 
"NCL", //"NCL2", "NSH", "RMK", "RSD", "RYU", "RYU2", "VEG", "VEG2", "ZGF",
]
];

  var CDIV = d3.select("#CHARS");
  CDIV.selectAll("div").data(CHARS).enter().append("div")
      .attr("class", function(d,i) {return "ROW"; })
      .selectAll("button").data(function(d){return d;}).enter().append("button").attr("class", function(d){ return "CHAR CHAR"+d;})
      .on("click",function(d,i){
        var p = d3.select(this.parentNode.parentNode).datum();
        d3.selectAll(".CHAR").classed("SEL",false);
        d3.select(this).classed("SEL",true);
        
        HASHCHAR = d;
        d3.tsv(HASHCHAR+".txt", UCGILLEY);
      })
      .text(function(d,i){return d;});

function UCTOP1() {
  var ADV = d3.select("#TOP1");
  var adv = ""
  for (var i=1;i<=119;i++) {
    adv += "<span class='UCLICK' onclick='UCKD("+i+")'>" + (i%10) + "</span>";
  }
  ADV.html(adv);
}

function UCKD(kd, hash) {
  var ADV = d3.select("#ADVKD");
  var adv = ""
  for (var i=1;i<=119;i++) {
    var text = i<kd ? "+" : i>=kd+10 ? "-" : ((i-kd+1)%10);
    adv += "<span class='UCLICK" + (i<kd||i>=kd+10?"":" WAKEUP") + "' onclick='UCKD("+i+")'>" + text + "</span>";
  }
  adv += "<span class='ADVPLUS'> +" + (kd-1) + " U HIT " + kd + "</span>";
  ADV.html(adv);
  HASHKD = kd;
  if (hash == undefined) UCHASH();
}
function UCKDBR(kd, hash) {
  var ADV = d3.select("#ADVKDBR");
  var adv = ""
  for (var i=1;i<=119;i++) {
    var text = i<kd ? "+" : i>=kd+10 ? "-" : ((i-kd+1)%10);
    adv += "<span class='UCLICK" + (i<kd||i>=kd+10?"":" WAKEUP") + "' onclick='UCKDBR("+i+",false);UCKDR("+(i-5)+")'>" + text + "</span>";
  }
  adv += "<span class='ADVPLUS'> +" + (kd-1) + " U HIT " + kd + "</span>";
  ADV.html(adv);
  HASHKDBR = kd;
  if (hash == undefined) UCHASH();
}
function UCKDR(kd, hash) {
  var ADV = d3.select("#ADVKDR");
  var adv = ""
  for (var i=1;i<=119;i++) {
    var text = i<kd ? "+" : i>=kd+10 ? "-" : ((i-kd+1)%10);
    adv += "<span class='UCLICK" + (i<kd||i>=kd+10?"":" WAKEUP") + "' onclick='UCKDR("+i+",false);UCKDBR("+(i+5)+");'>" + text + "</span>";
  }
  adv += "<span class='ADVPLUS'> +" + (kd-1) + " U HIT " + kd + "</span>";
  ADV.html(adv);  
  HASHKDR = kd;
  if (hash == undefined) UCHASH();
}
function UCFK() {
  var ADV = d3.select("#FK");
  var adv = ""
  for (var i=1;i<=119;i++) {
    adv += "<span class='UCLICK' onclick='UCOKI("+i+")'>" + (i%10) + "</span>";
  }
  ADV.html(adv);
}
function UCOKI(kd, hash) {

  var active = HASHACTIVE;
  var startup = HASHSTARTUP-1;
  var recovery = HASHRECOVERY;


  if (kd>0) FRAMEKILL = kd;
  var fk = FRAMEKILL;

  var ADV = d3.select("#ADVOKI");
  var adv = ""
  var text = "";
  var spanclass = "";
  for (var i=1;i<=119;i++) {

    if (i<FRAMEKILL) {
      text = "+";
      spanclass = "";
    } else {
      if (i <= FRAMEKILL+startup-1) {
        text = "s";
        spanclass = "STARTUP";
      }
      else if (i <= FRAMEKILL+startup+active-1) {
        text = "A";
        spanclass = "ACTIVE";
      }
      else if (i <= FRAMEKILL+startup+active+recovery-1) {
        text = "r";
        spanclass = "RECOVERY";
      } else {
        text = "-";
        spanclass = "";
      }
    }

    adv += "<span class='UCLICK " + spanclass + "' onclick='UCOKI("+i+")'>" + text + "</span>";
  }
  adv += "<span class='ADVPLUS'> +" + (FRAMEKILL-1) + " U HIT " + (FRAMEKILL + HASHSTARTUP - 1) + "</span>";
  ADV.html(adv);
  if (hash == undefined) UCHASH();
}


function UCGILLEY(rows){

  var KD = d3.select("#KD");
  var FRAMES = d3.select("#FRAMES");

  KD.selectAll("*").remove();
  FRAMES.selectAll("*").remove();

  var FRAMETABLE = FRAMES.append("div").append("table").classed("FRAMES",true);
  var KDTABLE = KD.append("div").append("table").classed("FRAMES",true);

  var keys = d3.keys(rows[0]);
  
  KDTABLE.append("thead").append("tr").selectAll("th").data(["KD ADV","KDR ADV","KDBR ADV"].concat(keys)).enter().append("th").text(function(d){return d;});
  KDTABLE.append("tbody").selectAll("tr").data(rows.filter(function(d){return !isNaN(d["KD Adv."]) && d["KD Adv."] != "";})).enter().append("tr")
            .classed("UC",function(d){return +d["KDRB Adv."]==HASHKDBR-1 || +d["KDR Adv."]==HASHKDR-1 || +d["KD Adv."]==HASHKD-1; })
            .selectAll("td").data(function(d){ return [{key:"KD",value:"+"+d["KD Adv."]},{key:"KDR",value:"+"+d["KDR Adv."]},{key:"KDBR",value:"+"+d["KDRB Adv."]}].concat(d3.entries(d));})
            .enter().append("td").text(function(d){return d.value;})
            .on("click",function(d){
              var p = this.parentNode;
              var pd = d3.select(p).datum();
              KDMOVE = pd;
              KDTABLE.selectAll(".UC").classed("UC",false);
              d3.select(p).classed("UC",true);
              //UCOKI(0);
              UCKD(+pd["KD Adv."]+1);
              if (!isNaN(pd["KDR Adv."]) && pd["KDR Adv."] != "") {
                UCKDR(+pd["KDR Adv."]+1);
                if (!isNaN(pd["KDRB Adv."]) && pd["KDRB Adv."] != "") {
                  UCKDBR(+pd["KDRB Adv."]+1);
                } else {
                  UCKDBR(+pd["KDR Adv."]+1);
                }
              } else {
                UCKDR(+pd["KD Adv."]+1);
                UCKDBR(+pd["KD Adv."]+1);
              }
              UCHASH();
            });
  
  FRAMETABLE.append("thead").append("tr").selectAll("th").data(["TOTAL"].concat(keys).concat([""])).enter().append("th").text(function(d){return d;});
  FRAMETABLE.append("tbody").selectAll("tr").data(rows).enter().append("tr")
            .classed("UC",function(d){return +d["Startup"]==HASHSTARTUP && +d["Active"]==HASHACTIVE && +d["Recovery"]==HASHRECOVERY; })
            .selectAll("td").data(function(d){return [{key:"TOTAL",value:d["Total "]}].concat(d3.entries(d)).concat([{key:"U C",value:"U C"}]);})
            .enter().append("td").text(function(d){return d.value;})
            .classed("UC",function(d){return d.key=="TOTAL" && +d.value==FRAMEKILL-1; })
            .on("click",function(d){
              var p = this.parentNode;
              var pd = d3.select(p).datum();
              

              if (d.key == "U C") {

                console.log(pd);

                FRAMETABLE.select("thead").insert("tr",":first-child")
                .selectAll("td").data( [{key:"TOTAL",value:d["Total "]}].concat(d3.entries(pd)).concat([{key:"U NO C",value:"U NO C"}]) )
                .enter().append("td").text(function(dd){ console.log(dd); return dd.value;})
                .on("click",function(dd){
                  var pp = this.parentNode;
                  if (dd.key == "U NO C") {
                    d3.select(pp).remove();
                  }
                });

                return;
              }

              FRAMETABLE.selectAll(".UC").classed("UC",false);
              d3.select(p).classed("UC",true);              
              
              OKIMOVE = pd;
              if (OKIMOVE != null) {
                if (!isNaN(OKIMOVE["Active"]) && OKIMOVE["Active"] != "") { HASHACTIVE = +OKIMOVE["Active"]; }  else { HASHACTIVE = 0; }
                if (!isNaN(OKIMOVE["Startup"]) && OKIMOVE["Startup"] != "") { HASHSTARTUP = +OKIMOVE["Startup"]; } else { HASHSTARTUP = 1; }
                if (!isNaN(OKIMOVE["Recovery"]) && OKIMOVE["Recovery"] != "") { HASHRECOVERY = +OKIMOVE["Recovery"]; } else { HASHRECOVERY = 0; }
              }
              UCOKI(0);
            });

}


MECHASH();

UCTOP1();
UCKD(HASHKD, false);
UCKDBR(HASHKDBR, false);
UCKDR(HASHKDR, false);
UCOKI(FRAMEKILL, false);
UCFK();
UCHASH();


d3.tsv(HASHCHAR+".txt", UCGILLEY);
d3.selectAll(".CHAR"+HASHCHAR).classed("SEL",true);

</script>

</body>
</html>
